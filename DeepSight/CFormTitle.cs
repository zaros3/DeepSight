using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace DeepSight
{
	public partial class CFormTitle : Form, CFormInterface
	{
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		// private
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private string m_strVersion;
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 생성자
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public CFormTitle()
		{
			InitializeComponent();
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 폼 로드
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void CFormTitle_Load( object sender, EventArgs e )
		{
			// 초기화
			Initialize();
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 폼 종료
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void CFormTitle_FormClosed( object sender, FormClosedEventArgs e )
		{
			// 해제
			DeInitialize();
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 초기화
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private bool Initialize()
		{
			bool bReturn = false;

			do {
				// 폼 초기화
				if( false == InitializeForm() ) break;
				m_strVersion = BtnVersionInfo.Text;

				SetButtonColor();

				bReturn = true;
			} while( false );

			return bReturn;
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 해제
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public void DeInitialize()
		{
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 폼 초기화
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public bool InitializeForm()
		{
			bool bReturn = false;
			
			do {
				var pDocument = CDocument.GetDocument;
                CConfig.CSystemParameter objSystem = pDocument.m_objConfig.GetSystemParameter();
				// 타이머 시작
				timer.Interval = 100;
				timer.Enabled = true;

				switch( pDocument.m_objConfig.GetSystemParameter().eMachineType ) {
					case CDefine.enumMachineType.PROCESS_60:
                        BtnTitle.Text = objSystem.strTitleProcess60;
                        break;
					case CDefine.enumMachineType.PROCESS_110:
                        BtnTitle.Text = objSystem.strTitleProcess110;
                        break;
					case CDefine.enumMachineType.PROCESS_150:
                        BtnTitle.Text = objSystem.strTitleProcess150;
                        break;
				}
				

				bReturn = true;
			} while( false );

			return bReturn;
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 버튼 색상 정의
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SetButtonColor()
		{
			var pFormCommon = CFormCommon.GetFormCommon;
			this.BackColor = pFormCommon.COLOR_WHITE;
			pFormCommon.SetButtonColor( this.BtnTitle, pFormCommon.COLOR_WHITE, pFormCommon.COLOR_WHITE );

            pFormCommon.SetButtonColor( this.BtnTitleLoginInfo, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
			pFormCommon.SetButtonColor( this.BtnLoginLevel, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
			pFormCommon.SetButtonColor( this.BtnUserID, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
			pFormCommon.SetButtonColor( this.BtnUserName, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
			pFormCommon.SetButtonColor( this.BtnTitleVersionInfo, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
			pFormCommon.SetButtonColor( this.BtnVersionInfo, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );

			pFormCommon.SetButtonColor( this.BtnTitleRecipeName, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
			pFormCommon.SetButtonColor( this.BtnTitleRecipeID, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );

			pFormCommon.SetButtonColor( this.BtnTimer, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );

            pFormCommon.SetButtonColor( this.BtnStatusPLCAlive, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
            pFormCommon.SetButtonColor( this.BtnStatusPCAlive, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
            pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
        }

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 언어 변경
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public bool SetChangeLanguage()
		{
			bool bReturn = false;

			do {
				// 데이터 테이블에서 일치하는 ID에 해당하는 TEXT를 불러옴
				SetControlChangeLanguage( this.BtnTitleLoginInfo );
				SetControlChangeLanguage( this.BtnTitleVersionInfo );

				bReturn = true;
			} while( false );

			return bReturn;
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 언어 변경
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SetControlChangeLanguage( Control obj )
		{
			var pDocument = CDocument.GetDocument;
			obj.Text = pDocument.GetDatabaseUIText( obj.Name, this.Name );
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 타이머 유무
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public void SetTimer( bool bTimer )
		{
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : Visible 유무
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public void SetVisible( bool bVisible )
		{
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 로그인 정보 갱신
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SetUpdateLogin()
		{
			var pDocument = CDocument.GetDocument;
			var pFormCommon = CFormCommon.GetFormCommon;
			CUserInformation objUserInformation = pDocument.GetUserInformation();
			// 로그인 정보
			string strAuthorityLevel = "";
			if( CDefine.enumUserAuthorityLevel.USER_AUTHORITY_LEVEL_OPERATOR == objUserInformation.m_eAuthorityLevel ) {
				strAuthorityLevel = "OPERATOR";
			}
			else if( CDefine.enumUserAuthorityLevel.USER_AUTHORITY_LEVEL_ENGINEER == objUserInformation.m_eAuthorityLevel ) {
				strAuthorityLevel = "ENGINEER";
			}
			else if( CDefine.enumUserAuthorityLevel.USER_AUTHORITY_LEVEL_MASTER == objUserInformation.m_eAuthorityLevel ) {
				strAuthorityLevel = "MASTER";
			}
			else {
				strAuthorityLevel = "NONE";
			}
			pFormCommon.SetButtonText( this.BtnLoginLevel, strAuthorityLevel );
			pFormCommon.SetButtonText( this.BtnUserID, objUserInformation.m_strID );
			pFormCommon.SetButtonText( this.BtnUserName, objUserInformation.m_strName );
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 시계 정보 갱신
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SetUpdateTime()
		{
			// 시계
			DateTime dt = DateTime.Now;
			var pFormCommon = CFormCommon.GetFormCommon;
			pFormCommon.SetButtonText( this.BtnTimer, string.Format( "{0:yyyy - MM - dd\r\nHH : mm : ss}", dt ) );
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 디바이스 연결상태 표시
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SetUpdateStatusDevice()
		{
			var pDocument = CDocument.GetDocument;
			var pFormCommon = CFormCommon.GetFormCommon;
            var objMMFVisionData = ENC.MemoryMap.Manager.CMMFManagerVisionData.Instance;
            

			// PLC연결상태
			if( true == pDocument.m_objProcessMain.m_objPLC.HLIsConnected() ) {
                if( true == objMMFVisionData[ ( int )0/*CDefine.enumAlignStage.STAGE_MAIN*/ ].bHeartBeat )
				    pFormCommon.SetButtonColor( this.BtnStatusPCAlive, pFormCommon.LAMP_GREEN_ON, pFormCommon.COLOR_WHITE );
                else
                    pFormCommon.SetButtonColor( this.BtnStatusPCAlive, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
                    pFormCommon.SetButtonColor( this.BtnStatusPLCAlive, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
            }
			else {
                pFormCommon.SetButtonColor( this.BtnStatusPLCAlive, pFormCommon.COLOR_RED, pFormCommon.COLOR_WHITE );
                pFormCommon.SetButtonColor( this.BtnStatusPLCAlive, pFormCommon.COLOR_RED, pFormCommon.COLOR_WHITE );
                pFormCommon.SetButtonColor( this.BtnStatusPCAlive, pFormCommon.COLOR_RED, pFormCommon.COLOR_WHITE );
			}

   
            

			// 카메라 연결상태
			// Loader
			if( CDefine.enumMachineType.PROCESS_60 == pDocument.m_objConfig.GetSystemParameter().eMachineType ) {
				// Input Tray 1
				if( true == pDocument.m_objProcessMain.m_objCamera[ ( int )CDefine.enumCamera.CAMERA_1 ].HLIsConnected() ) {
					pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
				}
				else {
					pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_RED, pFormCommon.COLOR_WHITE );
				}
			
			}
			// Unloader Align
			else if( CDefine.enumMachineType.PROCESS_110 == pDocument.m_objConfig.GetSystemParameter().eMachineType ) {
				// Conveyor 1
				if( true == pDocument.m_objProcessMain.m_objCamera[ ( int )CDefine.enumCamera.CAMERA_1 ].HLIsConnected() ) {
					pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
				}
				else {
					pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_RED, pFormCommon.COLOR_WHITE );
				}

			}
			// Unloader Tray
			else if( CDefine.enumMachineType.PROCESS_150 == pDocument.m_objConfig.GetSystemParameter().eMachineType ) {
				// Out Tray 1
				if( true == pDocument.m_objProcessMain.m_objCamera[ ( int )CDefine.enumCamera.CAMERA_1 ].HLIsConnected() ) {
					pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_TITLE, pFormCommon.COLOR_WHITE );
				}
				else {
					pFormCommon.SetButtonColor( this.BtnStatusCamera1, pFormCommon.COLOR_RED, pFormCommon.COLOR_WHITE );
				}

			}
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 레시피 상태 표시
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SetUpdateRecipeInformation()
		{
			var pDocument = CDocument.GetDocument;
			var pFormCommon = CFormCommon.GetFormCommon;
			// 레시피 아이디
			pFormCommon.SetButtonText( BtnTitleRecipeID, pDocument.m_objConfig.GetRecipeInformation().strRecipeID );
			// 레시피 이름
			pFormCommon.SetButtonText( BtnTitleRecipeName, pDocument.m_objConfig.GetRecipeInformation().strRecipeName );
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 타이머
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void timer_Tick( object sender, EventArgs e )
		{
			// 로그인 정보 갱신
			SetUpdateLogin();
			// 시계 정보 갱신
			SetUpdateTime();
			// 디바이스 상태 표시
			SetUpdateStatusDevice();
			// 레시피 상태 표시
			SetUpdateRecipeInformation();
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 로고 클릭 시 로그인 다이얼로그 띄워줌
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void SamsungLogo_Click( object sender, EventArgs e )
		{
			var pDocument = CDocument.GetDocument;
			// 버튼 로그 추가
			string strLog = string.Format( "[{0}] [{1}]", "SamsungLogo_Click", true );
			pDocument.SetUpdateButtonLog( this, strLog );

			// 현재 유저 정보 & 설비 상태를 넘겨줌
			CDialogLogin objLogin = new CDialogLogin();
			objLogin.ShowDialog();

			// 버튼 로그 추가
			strLog = string.Format( "[{0}] [{1}]", "SamsungLogo_Click", false );
			pDocument.SetUpdateButtonLog( this, strLog );
		}

		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//생성 : 
		//추가 : 
		//목적 : 로고 클릭 시 로그인 다이얼로그 띄워줌
		//설명 : 
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void BtnTitleLoginInfo_Click( object sender, EventArgs e )
		{
			var pDocument = CDocument.GetDocument;
			// 버튼 로그 추가
			string strLog = string.Format( "[{0}] [{1}]", "BtnTitleLoginInfo_Click", true );
			pDocument.SetUpdateButtonLog( this, strLog );

			// 현재 유저 정보 & 설비 상태를 넘겨줌
			CDialogLogin objLogin = new CDialogLogin();
			objLogin.ShowDialog();

			// 버튼 로그 추가
			strLog = string.Format( "[{0}] [{1}]", "BtnTitleLoginInfo_Click", false );
			pDocument.SetUpdateButtonLog( this, strLog );
		}

        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        //생성 : 
        //추가 : 
        //목적 : 시계 클릭시 최소화
        //설명 : 
        //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		private void BtnTimer_Click( object sender, EventArgs e )
		{
			var pDocument = CDocument.GetDocument;
			if( CDefine.enumUserAuthorityLevel.USER_AUTHORITY_LEVEL_OPERATOR == pDocument.GetUserInformation().m_eAuthorityLevel ) return;
			pDocument.GetMainFrame().WindowState = FormWindowState.Minimized;
		}
    }
}